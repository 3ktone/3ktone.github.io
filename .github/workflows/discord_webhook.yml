name: Discord Webhook Notification

on:
  push:
    branches:
      - main

jobs:

  notify-discord:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Get post title
      id: get_title
      run: |
        # RÃ©cupÃ©rer le titre du dernier commit
        TITLE=$(git log -1 --pretty=%s)
        echo "::set-output name=title::$TITLE"
      
    - name: Send Discord Notification
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_API_WEBHOOK }}
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -d "{\"content\": \"ðŸ“¢ @everyone Nouveau post : **${{ steps.get_title.outputs.title }}**\nðŸ‘‰ https://ton-site.github.io/ton-post\"}" \
        "$DISCORD_WEBHOOK_URL"
